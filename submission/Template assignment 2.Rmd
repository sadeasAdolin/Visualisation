---
title: "Template for Assignment"
author: "Student Name and Student number here for each member of group"
date: "12/09/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Assignment 2

### Information and tips in Rmarkdown

We can set different heading sizes by the number of hashtags infront

## Heading 2

### Heading 3

###### Heading 7


We can also include code in an rmarkdown but not have it run i.e. for `install.packages()` as we only need to install once and not again. This is done by include `eval=FALSE` in the rchunk- See install.packages() in chunk below.

### Layout for Assignment

### Introduction

Discuss the managerial report here and the data set you are working on. Discuss variable of interest and aslign with the business decision making problem. i.e. I will use the NSW COVID dataset from online source

Note: If presenting data look at DT package (Week 9 lecture notes)

```{r, eval=FALSE}
install.packages("RCurl")
install.package("ggplot2")
instal.package("data.table")
```

```{r}
library(RCurl)
```

```{r}
url_content = getURL("https://data.nsw.gov.au/data/dataset/97ea2424-abaf-4f3e-a9f2-b5c883f42b6a/resource/2776dbb8-f807-4fb2-b1ed-184a6fc2c8aa/download/confirmed_cases_table4_location_likely_source.csv")
covidnsw = read.csv(textConnection(url_content), header=T)
```



### Analysis

Include various plots using the packages learnt throughout the course i.e. ggplot2() or other data visualisation methods; and/or code used to produce data i.e. count() or mutate (i.e. mutate data could be used to produce seven day average for covid data which is smoother and more representative)

For our example of the NSW Data- I might produce a plot of case in LGA 

```{r}
library(dplyr)
covid_bylhd=covidnsw %>% 
  count(lhd_2010_name)
```

Plot of cases by LGA


```{r, fig.align = 'center'}
library(ggplot2)
ggplot(covid_bylhd, aes(reorder(lhd_2010_name,-n), n)) + 
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))+
  ggtitle("Covid cases throughout Pandemic by LGA") +
  theme(plot.title = element_text(hjust = 0.5))
```

Interpretation of results here brieftly. 


### Shiny Application

Include the shiny application here for the data variable you are looking at including or describing. Let say an interactive plot for cases in LGA in Hunter new England Area in latest outbreak. Firstly save as data table (allow searchability and reduction) extract that data you are after.


```{r}
library(data.table)
covidnsw=as.data.table(covidnsw)
covidnswhne_local_2= covidnsw[(as.character(notification_date) >="2021-07-10") & !(likely_source_of_infection %in% "Overseas") & (lhd_2010_name %in% "Hunter New England")]  #remove Oversea cases only and latest outbreak and from HNE area

covid1=covidnswhne_local_2 %>%
  count(notification_date, lga_name19)    #Covid cases in each LGA and number each data

covid1$notification_date=as.Date(covid1$notification_date)  #Make sure the variable is a date format
```

NOTE: To make these interactive, download this rmarkdown file on your computer and run all above chucks, and then run each of the chuck below one at a time which will open the shiny object. The submitted assignment in html format wont run these shiny objects in an interactive way- this requires the object to be published and have a url link (not covered or required in course). This is why the rmarkdown document will be required for marking.

I will include two different way to present the same plot- 

```{r}
library(shiny)
library(ggplot2)

ui <- fluidPage(
  titlePanel("Dashboard"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput(inputId = "quintile", label = ("LGA Within Hunter New England Health"),
                  choices = unique(covid1$lga_name19)
      )),
    
    
    
    
    mainPanel(
      plotOutput(outputId = "plot")
    )
  )
)


# Define server logic required to draw a histogram
server <- function(input, output) {
  filtered_data<- reactive({
    test <- covid1[covid1$lga_name19 %in% input$quintile]
    
     })
  output$plot <- renderPlot({ggplot(filtered_data(), aes(x = notification_date, y = n)) + 
    geom_line(aes(colour=lga_name19, group=lga_name19)) +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
    ggtitle("Covid cases in HNE by LGA") +
    theme(plot.title = element_text(hjust = 0.5))},height = 400,width = 600)}


shinyApp(ui = ui, server = server)
```


This second option allows multiple LGA within HNE to be selected. 

```{r}
library(shiny)
library(ggplot2)

ui <- fluidPage(
    sidebarLayout(sidebarPanel(selectInput(inputId = "quintile", label = ("LGA Within Hunter New England Health"),choices = unique(covid1$lga_name19), multiple = TRUE, selected=as.factor(as.character(covid1$lga_name19))[1])),
                               mainPanel(plotOutput(outputId = "plot")
    )))



# Define server logic required to draw a histogram
server <- function(input, output) {
  filtered_data<- reactive({
    test <- covid1[covid1$lga_name19 %in% input$quintile]
    
     })
  output$plot <- renderPlot({ggplot(filtered_data(), aes(x = notification_date, y = n)) + 
    geom_line(aes(colour=lga_name19, group=lga_name19)) +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
    ggtitle("Covid cases in HNE by LGA") +
    theme(plot.title = element_text(hjust = 0.5))+  scale_x_date(limits = c(min(as.Date(covid1$notification_date)),max(as.Date(covid1$notification_date))))},height = 400,width = 600)}


shinyApp(ui = ui, server = server)
```

### Discussion of results

Discuss here in more detail the results and extract main points


### Conclusions or recommendation



### References 


